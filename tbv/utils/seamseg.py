"""
Copyright (c) 2021
Argo AI, LLC, All Rights Reserved.

Notice: All information contained herein is, and remains the property
of Argo AI. The intellectual and technical concepts contained herein
are proprietary to Argo AI, LLC and may be covered by U.S. and Foreign
Patents, patents in process, and are protected by trade secret or
copyright law. This work is licensed under a CC BY-NC-SA 4.0 
International License.

Originating Authors: John Lambert
"""

"""
Interface to the `seamseg` taxonomy.
Reference:
    https://github.com/mapillary/seamseg
"""

import numpy as np

# `seamseg` categories are ordered/indexed as follows:
SEAMSEG_CLASSES = [
    "construction--barrier--curb",
    "construction--barrier--fence",
    "construction--barrier--guard-rail",
    "construction--barrier--other-barrier",
    "construction--barrier--wall",
    "construction--flat--bike-lane",
    "construction--flat--curb-cut",
    "construction--flat--parking",
    "construction--flat--pedestrian-area",
    "construction--flat--rail-track",
    "construction--flat--road",
    "construction--flat--service-lane",
    "construction--flat--sidewalk",
    "construction--structure--bridge",
    "construction--structure--building",
    "construction--structure--tunnel",
    "marking--general",
    "nature--mountain",
    "nature--sand",
    "nature--sky",
    "nature--snow",
    "nature--terrain",
    "nature--vegetation",
    "nature--water",
    "object--pothole",
    "object--vehicle--on-rails",
    "void--car-mount",
    "void--ego-vehicle",
    "animal--bird",
    "animal--ground-animal",
    "construction--flat--crosswalk-plain",
    "human--person",
    "human--rider--bicyclist",
    "human--rider--motorcyclist",
    "human--rider--other-rider",
    "marking--crosswalk-zebra",
    "object--banner",
    "object--bench",
    "object--bike-rack",
    "object--billboard",
    "object--catch-basin",
    "object--cctv-camera",
    "object--fire-hydrant",
    "object--junction-box",
    "object--mailbox",
    "object--manhole",
    "object--phone-booth",
    "object--street-light",
    "object--support--pole",
    "object--support--traffic-sign-frame",
    "object--support--utility-pole",
    "object--traffic-light",
    "object--traffic-sign--back",
    "object--traffic-sign--front",
    "object--trash-can",
    "object--vehicle--bicycle",
    "object--vehicle--boat",
    "object--vehicle--bus",
    "object--vehicle--car",
    "object--vehicle--caravan",
    "object--vehicle--motorcycle",
    "object--vehicle--other-vehicle",
    "object--vehicle--trailer",
    "object--vehicle--truck",
    "object--vehicle--wheeled-slow",
]


seamseg_color_mapping = {
    "human--person": [220, 20, 60],
    "object--vehicle--car": [0, 0, 142],
    "object--support--pole": [153, 153, 153],
    "construction--barrier--fence": [190, 153, 153],
    "object--vehicle--trailer": [0, 0, 110],
    "construction--flat--road": [169, 169, 169],  # now GRAY_RGB , before was [128, 64,128],
    "void--ego-vehicle": [0, 0, 0],
    "human--rider--bicyclist": [255, 0, 0],  # rider
    "human--rider--motorcyclist": [255, 0, 0],  # rider
    "construction--flat--sidewalk": [244, 35, 232],
    "construction--flat--rail-track": [230, 150, 140],
    "object--vehicle--bus": [0, 60, 100],
    "nature--terrain": [152, 251, 152],
    "nature--vegetation": [107, 142, 35],
    "marking--general": [255, 255, 255],  # [250,210,1] # before was TRAFFIC_YELLOW1_RGB
}


# labels = [
#     'unlabeled'           : [  0,  0,  0],
#     'rectification border': [  0,  0,  0],
#     'out of roi'          : [  0,  0,  0],
#     'static'              : [  0,  0,  0],
#     'dynamic'             : [111, 74,  0],
#     'ground'              : [ 81,  0, 81],
#     'parking'             : [250,170,160],
#     'building'            : [ 70, 70, 70],
#     'wall'                : [102,102,156],
#     'guard rail'          : [180,165,180],
#     'bridge'              : [150,100,100],
#     'tunnel'              : [150,120, 90],
#     'polegroup'           : [153,153,153],
#     'traffic light'       : [250,170, 30],
#     'traffic sign'        : [220,220,  0],
#     'sky'                 : [ 70,130,180],
#     'truck'               : [  0,  0, 70],
#     'caravan'             : [  0,  0, 90],
#     'train'               : [  0, 80,100],
#     'motorcycle'          : [  0,  0,230],
#     'bicycle'             : [119, 11, 32],
#     'license plate'       : [  0,  0,142],
# ]


SEAMSEG_PALETTE = (
    np.array(
        [
            0.000,
            0.447,
            0.741,
            0.850,
            0.325,
            0.098,
            0.929,
            0.694,
            0.125,
            0.494,
            0.184,
            0.556,
            0.466,
            0.674,
            0.188,
            0.301,
            0.745,
            0.933,
            0.635,
            0.078,
            0.184,
            0.300,
            0.300,
            0.300,
            0.600,
            0.600,
            0.600,
            1.000,
            0.000,
            0.000,
            1.000,
            0.500,
            0.000,
            0.749,
            0.749,
            0.000,
            0.000,
            1.000,
            0.000,
            0.000,
            0.000,
            1.000,
            0.667,
            0.000,
            1.000,
            0.333,
            0.333,
            0.000,
            0.333,
            0.667,
            0.000,
            0.333,
            1.000,
            0.000,
            0.667,
            0.333,
            0.000,
            0.667,
            0.667,
            0.000,
            0.667,
            1.000,
            0.000,
            1.000,
            0.333,
            0.000,
            1.000,
            0.667,
            0.000,
            1.000,
            1.000,
            0.000,
            0.000,
            0.333,
            0.500,
            0.000,
            0.667,
            0.500,
            0.000,
            1.000,
            0.500,
            0.333,
            0.000,
            0.500,
            0.333,
            0.333,
            0.500,
            0.333,
            0.667,
            0.500,
            0.333,
            1.000,
            0.500,
            0.667,
            0.000,
            0.500,
            0.667,
            0.333,
            0.500,
            0.667,
            0.667,
            0.500,
            0.667,
            1.000,
            0.500,
            1.000,
            0.000,
            0.500,
            1.000,
            0.333,
            0.500,
            1.000,
            0.667,
            0.500,
            1.000,
            1.000,
            0.500,
            0.000,
            0.333,
            1.000,
            0.000,
            0.667,
            1.000,
            0.000,
            1.000,
            1.000,
            0.333,
            0.000,
            1.000,
            0.333,
            0.333,
            1.000,
            0.333,
            0.667,
            1.000,
            0.333,
            1.000,
            1.000,
            0.667,
            0.000,
            1.000,
            0.667,
            0.333,
            1.000,
            0.667,
            0.667,
            1.000,
            0.667,
            1.000,
            1.000,
            1.000,
            0.000,
            1.000,
            1.000,
            0.333,
            1.000,
            1.000,
            0.667,
            1.000,
            0.333,
            0.000,
            0.000,
            0.500,
            0.000,
            0.000,
            0.667,
            0.000,
            0.000,
            0.833,
            0.000,
            0.000,
            1.000,
            0.000,
            0.000,
            0.000,
            0.167,
            0.000,
            0.000,
            0.333,
            0.000,
            0.000,
            0.500,
            0.000,
            0.000,
            0.667,
            0.000,
            0.000,
            0.833,
            0.000,
            0.000,
            1.000,
            0.000,
            0.000,
            0.000,
            0.167,
            0.000,
            0.000,
            0.333,
            0.000,
            0.000,
            0.500,
            0.000,
            0.000,
            0.667,
            0.000,
            0.000,
            0.833,
            0.000,
            0.000,
            1.000,
            0.000,
            0.000,
            0.000,
            0.143,
            0.143,
            0.143,
            0.857,
            0.857,
            0.857,
            1.000,
            1.000,
            1.000,
        ]
    )
    .astype(np.float32)
    .reshape(-1, 3)
)
SEAMSEG_PALETTE = (SEAMSEG_PALETTE * 255).astype(np.uint8)


for classname, color_rgb in seamseg_color_mapping.items():
    class_idx = SEAMSEG_CLASSES.index(classname)
    SEAMSEG_PALETTE[class_idx] = color_rgb
